# withClauseTools

## 概要
- With句を表現するためのツールクラス/関数群
- １つのSelect文の、With句を扱う
    - With句の中には複数のSelect文を書けるが、その場合はその各々でここで記述する仕組みを持つことになる
    - 逆に、扱うSelect文の外のテーブルなどには関心を向けず、影響を及ぼさない

## 前提：With句の性質
- With句は、複数のSelect文によってなっている
    - 以下では、With句内のSelect文を、１つのwithと称し、それらをまとめてwith群とする
    - 実体は、withとは、QueryComponents/ClauseWithである
- with群は、いずれかのwithを参照していることがある、それらは複数の場合もある
- 参照されているwithを親、しているwithを子と呼ぶ
- どのwithも参照していない場合は、最上位の親となる
- 参照するテーブル名が、クエリ内のテーブル名にない場合は、解析中のクエリの外の実テーブルを参照している

## 表示のさせ方
- withの１つごとに１つのBoxとする
- 階層ごとにグループに分け、それらのグループを横に並べる
    - 階層の上位が左、下位が右
    - グループ内に、複数のwithのBoxが入る
- グループ内のwithは同じ階層であり、それらは縦に並べる
    - クエリ内の登場順序順に、上から並べる

## 実現方法
### 論理構造
- 下記の構成で情報を持つ
    1. With句全体を管理するオブジェクト
        - 階層を子に持つ
    2. 階層ごとの管理オブジェクト
        - withを子に持つ
    3. withごとの管理オブジェクト
        - withの実体、詳細情報を持つ

### 物理構造
1. WithsManager
    - 概要
        - With句全体を管理するオブジェクト
    - プロパティ
        - WithsGroupManagerリスト
    - メソッド
        - withリストを追加
            - withを１つ追加
        - withを１つ追加（private）
            - WithInfoをインスタンス化し、パース
            - 親テーブルが所属するWithsGroupManagerの１つ下の階層に、WithManagerを追加
                - １つ下の階層が存在しない場合は、最下層にWithsGroupManagerを作成
        - withの名前リストを取得
        - WithsGroupManagerリストを取得
        - with句の有無
        - toBox
2. WithsGroupManager
    - 概要
        - 階層ごとの管理オブジェクト
    - プロパティ
        - WithInfoリスト
    - メソッド
        - WithInfoを１つ追加
        - withの名前リストを取得
        - withの名前に、引数の名前があるかどうかを確認
        - toBox
3. WithInfo
    - 概要
        - withごとの管理オブジェクト
    - プロパティ
        - withデータ
        - 親テーブル名のリスト
    - メソッド
        - (コンストラクタ)
            - パース
        - withの名前を取得
        - パース（private）
        - 参照する親テーブル名リストを取得
        - toBox

